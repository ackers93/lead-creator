<div class="leads-page" data-controller="view-toggle">
  <div class="container">
    <div class="page-header">
      <h1>My Leads</h1>
      <div class="header-actions">
        <div class="view-toggle">
          <button type="button" 
                  class="btn btn-sm btn-outline-secondary view-toggle-btn" 
                  data-view-toggle-target="cardBtn"
                  data-action="click->view-toggle#showCards"
                  data-view="card">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
            </svg>
            Cards
          </button>
          <button type="button" 
                  class="btn btn-sm btn-outline-secondary view-toggle-btn" 
                  data-view-toggle-target="tableBtn"
                  data-action="click->view-toggle#showTable"
                  data-view="table">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0V6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
            </svg>
            Table
          </button>
        </div>
        <%= link_to "New Lead", new_lead_path, class: "btn btn-primary" %>
      </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="leads-filters">
      <%= form_with url: leads_path, method: :get, data: { turbo_frame: "leads", turbo_action: "advance" }, class: "filters-form" do |f| %>
        <div class="filter-row">
          <div class="filter-group">
            <%= f.text_field :query, 
                            value: params[:query], 
                            placeholder: "Search by business name, contact, or location...", 
                            class: "form-control search-input" %>
          </div>

          <div class="filter-group">
            <%= f.select :status, 
                        Lead.statuses.keys.map { |s| [s.titleize, s] }, 
                        { prompt: "All Statuses", selected: params[:status] },
                        { class: "form-control" } %>
          </div>

          <div class="filter-group">
            <%= f.select :interest_level, 
                        Lead.interest_levels.keys.map { |l| [l.titleize, l] }, 
                        { prompt: "All Interest Levels", selected: params[:interest_level] },
                        { class: "form-control" } %>
          </div>

          <div class="filter-group">
            <%= f.submit "Filter", class: "btn btn-secondary" %>
            <% if params[:query].present? || params[:status].present? || params[:interest_level].present? %>
              <%= link_to "Clear", leads_path, class: "btn btn-light" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Leads List -->
    <%= turbo_frame_tag "leads" do %>
      <% if @leads.any? %>
        <!-- Card View -->
        <div class="leads-grid" data-view-toggle-target="cardView">
          <% @leads.each do |lead| %>
            <%= render "lead_card", lead: lead %>
          <% end %>
        </div>

        <!-- Table View -->
        <div class="leads-table" data-view-toggle-target="tableView" style="display: none;">
          <%= render "leads_table", leads: @leads %>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ“‹</div>
          <h3>No leads found</h3>
          <p>Start by creating your first lead or adjust your filters.</p>
          <%= link_to "Create Lead", new_lead_path, class: "btn btn-primary", data: { turbo_frame: "_top" } %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
